--계정생성
CREATE USER JSP IDENTIFIED BY JSP;

--권한 부여
GRANT RESOURCE, CONNECT TO JSP;

--테이블 스페이스 지정
ALTER USER JSP DEFAULT TABLESPACE USERS QUOTA UNLIMITED ON USERS;

--회원
CREATE TABLE USERS (
    EMAIL VARCHAR2(30),
    NAME VARCHAR2(30),
    PW VARCHAR2(30),
    PHONE VARCHAR2(30),
    GENDER CHAR(1),
    SNS_YN CHAR(1),
    REGDATE DATE DEFAULT SYSDATE
    );
    
ALTER TABLE USERS ADD CONSTRAINT EMAIL_PK PRIMARY KEY (EMAIL);
ALTER TABLE USERS ADD CONSTRAINT GENDER_CK CHECK (GENDER IN ('M', 'F'));
ALTER TABLE USERS ADD CONSTRAINT SNS_CK CHECK(SNS_YN IN ('Y', 'N'));

--게시글
CREATE TABLE BOARD(
    BNO NUMBER(10),
    EMAIL VARCHAR2(30), --회원의 이메일과 연관되는 FK
    TITLE VARCHAR2(200) NOT NULL,
    CONTENT VARCHAR2(1000),
    REGDATE DATE DEFAULT SYSDATE
                );
                
ALTER TABLE BOARD ADD CONSTRAINT BOARD_PK PRIMARY KEY (BNO);

CREATE SEQUENCE BOARD_SEQ NOCACHE;

--글 상세보기에서 이전글 다음글 기능
SELECT *
FROM (
    SELECT B.*,
       LAG(BNO, 1, 0) OVER(ORDER BY BNO) AS PREV_NO,
       LAG(TITLE, 1, '이전 글이 없습니다') OVER(ORDER BY BNO) AS PREV_TITLE,
       LEAD(BNO, 1, 0) OVER(ORDER BY BNO) AS NEXT_NO,
       LEAD(TITLE, 1, '다음 글이 없습니다') OVER(ORDER BY BNO) AS NEXT_TITLE
FROM BOARD B
)
WHERE BNO = #{BNO}

SELECT * FROM BOARD;